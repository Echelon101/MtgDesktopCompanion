<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Site Title</title>
  
    <link href="//cdn.jsdelivr.net/npm/jquery-ui-dist@latest/jquery-ui.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet" type="text/css">
  	<script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
 	<script src="//cdn.jsdelivr.net/npm/jquery-autocomplete@latest/jquery.autocomplete.min.js"></script>
  	<script src="//cdn.jsdelivr.net/npm/jquery-ui-dist@latest/jquery-ui.min.js"></script>
 
	<script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" type="text/javascript"></script>
	
	
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" type="text/javascript"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" type="text/css">



    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" type="text/css">
	<link href="//cdn.jsdelivr.net/npm/keyrune@latest/css/keyrune.css" rel="stylesheet" type="text/css" />
    <link href="//cdn.jsdelivr.net/npm/mana-font@latest/css/mana.css" rel="stylesheet" type="text/css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
 
    <link href="//cdn.jsdelivr.net/npm/datatables@latest/media/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" >
 	<script src="//cdn.jsdelivr.net/npm/datatables@latest/media/js/jquery.dataTables.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/datatables-bootstrap@latest/js/dataTables.bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/datatables-responsive@latest/js/dataTables.responsive.min.js"></script>
 
	<script src="js/js-var.js"></script>
   	<script src="js/cart.js"></script>
    <script src="../dist/js/rest-server.js"></script>

	<script>
	 $(document).ready(function() {	
		 var array = [];	
	   	 $("#footer").load("footer.html");
	   	 $("#header").load("nav.html");
	   	 $("#banner").load("banner.html");

    		var collection;
    		var maxLastProduct=4;
    		var currency = "";
		   	$.ajax({
			        url: restserver+"/webshop/config"
			    }).then(function(data) {
			    	
			    	$('#siteTitle').html(data.siteTitle);
			    	$('#bannerTitle').html(data.bannerTitle);
			       	$('#bannerText').html(data.bannerText);
			       	$('#aboutText').html(data.aboutText);
			       	document.title = data.siteTitle;
			       	currency = data.currencySymbol;
			       	maxLastProduct=data.maxLastProduct;
			       	
			    	$('#contactName').html(data.contact.name + " " + data.contact.lastName);
			    	$('#contactEmail').html("<a href='mailto:"+data.contact.email+"'>"+data.contact.email+"</a>");
			    	$('#contactTelephone').html(data.contact.telephone);
			    	$('#contactWebsite').html(data.contact.website);
			    	$('#contactAddress').html(data.contact.address);
			    	$('#contactCountry').html(data.contact.country);
			  
		
			
		 	var dtTable = $('#tableCart').DataTable({
		 		"data":getCartItems(),
		    	"responsive": true,
		        "processing": true,
		        "pageLength": 10,
		        "searching": false,
		        "info":     false,
		        "paging":   false,
		        
		        "footerCallback": function ( row, data, start, end, display ) {
		        	
		        	var api = this.api(), data;
		        	// Total over all pages
		            total = api
		                .column(7)
     					.cache('search')
		                .reduce( function (a, b) {
		                	return parseFloat(a) + parseFloat(b);
		                }, 0 );
		 			
		            
		            // Update footer
		            $( api.column( 7 ).footer() ).html(
		            	total.toFixed(2) + " "+currency
		            );
		        },
		        
		        "columns": [
	        		{ 
		        	  "data": "idstock",
		        	  "render": function(data, type, row, meta){
		                	 if(type === 'display'){
									data="<a class='fa fa-search fa-fw' href='product.html?id="+data+"'/>";		                		 
		                	 }
		                   return data;
		                }
		        	},
	        		{ 
			          "data": "magicCard.name"
		        	},
		        	{ 
				          "data": "magicCard.editions",
				          "render": function(data, type, row, meta){
			                   if(type === 'display'){
			                	   //data="<i class='ss ss-"+data[0].id.toLowerCase()+"'/>"+data[0].set;	
			                	   data=data[0].set;
			                   }
			                 return data;
			              }
			        },
			        { 
			          "data": "language"
		        	},
		        	{ 
				       "data": "foil", 
				       "render": function(data, type, row, meta){
		                   if(type === 'display'){
		                	  if(data)
		                		  data = "<i class='fas fa-star fa-1x'/>";
		                		  else
		                			  data ="";  
		                   }
		                 return data;
		              }
			        },
		        	
		        	{ 
				      "data": "qte"
			        },
			        { 
					      "data": "price",
					      "render": function(data, type, row, meta){
			                	 if(type === 'display'){
										data=data.toFixed(2) + " " + currency;		                		 
			                	 }
			                   return data;
			                }
				    },
				    { 
					      "data": null,
					      "render": function(data, type, row, meta){
			                	 if(type === 'display'){
										data=(row.qte*row.price).toFixed(2) + "" +currency;
			                	 }
			                   return data;
			                }
				    },
				    { 
					      "data": "idstock",
					      "render": function(data, type, row, meta){
			                   if(type === 'display'){
			                	  data = "<i id='deleteFromCard' class='fas fa-trash-alt fa-1x' data='"+data+"'/>";
			                   }
			                 return data;
					      }     
				    }
	        		],
	        		
		    } );
		 
	   	 	
	 
			
			$('#tableCart').on('click', '#deleteFromCard', function (e) {
				removeStockId($(this).attr("data"));
				dtTable.row($(this).parents('tr')).remove().draw(false);
			});
			
			
			
			$('#checkoutBtn').click(function (e) {
				var json = createJSONOrder($("[class=form-control]"));
		
				$.post(restserver+"/transaction/add",JSON.stringify(json)).done(function( data ) {
					  												$( "#result" ).html("resultat="+data);
					  													clearCart();
																	}); 
				
				
				
			});
			
			
		  });
		   	
		   	
		   	
	 	
	 
	 	});
	 
	 
	 	
	
	
	</script>




</head>
<body>


<nav id="header" class="navbar navbar-expand-md navbar-dark bg-dark"></nav>
<section id="banner" class="jumbotron text-center"></section>



<div class="container mb-2">
    <div class="row">
    	<div class="col">
    		<div class="card">
	    		<div class="card-header bg-warning text-white"><i class="fas fa-shopping-cart"></i> Cart</div>
	    		<div class="card-body">
			         <table id="tableCart" class="display">
					        <thead>
					            <tr>
					            	<th></th>
					                <th>Product</th>
					                <th>Set</th>
					                <th>Language</th>
					                <th>Foil</th>
					                <th>Quantity</th>
					                <th>Price</th>
					                <th>Total</th>
					                <th>Action</th>
					            </tr>
					        </thead>
					        <tfoot align="right">
					        	<tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr>
					        </tfoot>
					</table>
			</div>
			</div>
		
		</div>
		 <div class="col">
            <div class="card">
                <div class="card-header bg-primary text-white"><i class="fa fa-envelope"></i>Contact Information</div>
                <div class="card-body">
                    <form>
                        <div class="form-group">
                            <label for="name">Name</label>
                            <input type="text" class="form-control" id="name" aria-describedby="last Name" placeholder="Enter name" required>
                        </div>
                       <div class="form-group">
                            <label for="lastName">Last Name</label>
                            <input type="text" class="form-control" id="lastName" aria-describedby="lastName" placeholder="Enter name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email address</label>
                            <input type="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Enter email" required>
                            <small id="emailHelp" class="form-text text-muted">will be used to contact you</small>
                        </div>
                        <div class="form-group">
                            <label for="message">Message</label>
                            <textarea class="form-control" id="message" rows="6"></textarea>
                        </div>
                        <div class="mx-auto">
                      	</div>
                    </form>
                </div>
            </div>
        </div>
	</div>
	<br/>
	<div>
       <div class="row">
           <div class="col-sm-12 col-md-2 text-right">
           		<button id="checkoutBtn" class="btn btn-lg btn-block btn-success text-uppercase" >Checkout</button>
           	</div>
           	<div class="col-sm12 col-md2"><span id="result"></span></div>
       </div>
        
    </div>
</div>

<!-- Footer -->
<!-- Footer -->
<footer class="text-light" id="footer"></footer>


</body>
</html>
