<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/png" href="../dist/img/favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    MTGCompanion - Prices
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mouse0270-bootstrap-notify/3.1.5/bootstrap-notify.min.js"></script>
  <script src="https://unpkg.com/@trevoreyre/autocomplete-js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script> 


  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://unpkg.com/@trevoreyre/autocomplete-js/dist/style.css" rel="stylesheet" />
  <link href="//cdn.jsdelivr.net/npm/keyrune@latest/css/keyrune.css" rel="stylesheet" type="text/css" />
  <link href="../dist/css/paper-dashboard.css" rel="stylesheet" />
  
<script src="../dist/js/js-var.js"></script>
  <script src="../dist/js/demo.js"></script>
  <script src="../dist/js/rest-server.js"></script>
  
  
  <script>
	  $(document).ready(function() {
		  	
		  $(document).ajaxStart(function () 
					{
					    $('.loading').html("<div class='spinner-border text-primary'></div>"); 
					});

					$(document).ajaxStop(function() 
					{
						 $('.loading').html("");  
					});
		  
		  
		  	 new Autocomplete('#autocomplete', {
				 search: input => {
			      return new Promise(resolve => {
					       if (input.length < 3) {
					          return resolve([])
					        }
			        fetch(restserver+'/cards/suggestcard/'+input)
			          .then(response => response.json())
			          .then(data => {
							resolve(data)
						})
			      })
			    },
			    getResultValue: result =>result.name ,
				debounceTime: 500, 
				renderResult: (result, props) => `
						    <li ${props}>
						      <div class="result-title">
						        ${result.name}
						      </div>
						      <div class="result-set">
										<i class="ss ss-2x ss-${result.editions[0].keyRuneCode.toLowerCase()}"></i>
										 ${result.editions[0].set}
						      </div>
						    </li>
						  `,
			    onSubmit: result => {
			      load(result);
			    }



			  });
	
	
			
			if($_GET("id"))
			{
				$.get(restserver+"/cards/"+$_GET("id"),function(data){
					load(data);
				});
			}
	
			function load(card)
			{
				$("#cardpic").attr("src","https://api.scryfall.com/cards/"+card.scryfallId+"?format=image");
				$("#cardTitle").html(card.name);
				$("#cardSet").html(card.editions[0].set);
				$("#linkshare").html("<a href='"+window.location+"?id="+card.id+"'>copy</a>");
				
				
				$.get(restserver+"/dash/variations/card/"+card.id,function(data){
					   	charts.initCharts(data);
					   	$("#provider").html(data.provider);
						var mapNormal = Object.values(data.normal).map(e=>e.value);
						var mapFoil =  Object.values(data.foil).map(e=>e.value);
					
						var valueN = mapNormal.slice(-1)[0];
						var valueF =mapFoil.slice(-1)[0];
						
						var valueWeekN = mapNormal.slice(-7)[0];
						var valueWeekF =mapFoil.slice(-7)[0];
						
	   			
						var percentWeekNormal = new Number(( ( valueN - valueWeekN ) / valueWeekN ) * 100).toFixed(2);
						var percentWeekFoil= new Number(( ( valueF - valueWeekF ) / valueWeekF ) * 100).toFixed(2);
					
						var iconN = (valueWeekN > valueN)? "<i class='fa fa-arrow-down text-danger' aria-hidden='true'></i>":"<i class='fa fa-arrow-up text-success' aria-hidden='true'></i>";
						var iconF = (valueWeekF > valueF)? "<i class='fa fa-arrow-down text-danger' aria-hidden='true'></i>":"<i class='fa fa-arrow-up text-success' aria-hidden='true'></i>";
						
						
						
						$("#lastPriceNormal").html(iconN + " " + data.currency + " " + valueN.toFixed(2));
						$("#lastPriceFoil").html(iconF + " <i class='ss ss-mythic ss-2x ss-pmei'></i>" + data.currency + " " + valueF.toFixed(2));
		
				});
							
			
					
			
				
			}
	
		
			
	 });
</script>
  
  
  
</head>

<body class="">
  <div class="wrapper ">
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
        <div class="container-fluid">
          <div class="navbar-wrapper">
		  <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
          </button>
            <a class="navbar-brand" href="javascript:;">MTGCompanion</a>
          </div>
          <div class="collapse navbar-collapse justify-content-center" id="navigation">
              <div id="autocomplete" class="autocomplete input-group no-border ">
                <input type="text" value="" class=" autocomplete-input" placeholder="Search..." style="width:350px">
                 <ul class="autocomplete-result-list"></ul>
              </div>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="content">
        <div class="row">
          <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="card card-stats">
              <div class="card-body ">
                <div class="row">
                  <div class="col-5 col-md-4">
                    <div class="icon-big text-center icon-warning">
					  <img class="img img-fluid" id="cardpic" src=""/>
                    </div>
                  </div>
                  <div class="col-7 col-md-7">
                    <div class="numbers">
                      <p class="card-category" id="cardSet"></p>
                      <p class="card-title" id="cardTitle"><p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats"> </div>
              </div>
            </div>
          </div>
           
          <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="card card-stats">
              <div class="card-body ">
                <div class="row">
                  <div class="col-5 col-md-4">
                    <div class="icon-big text-center icon-warning">
                      <i class="nc-icon nc-money-coins text-success"></i>
                    </div>
                  </div>
                  <div class="col-7 col-md-8">
                    <div class="numbers">
                      <p class="card-category">Market Price</p>
                      <div class="loading"></div>
                      <p class="card-title" id="lastPriceNormal"><p>
					  <p class="card-title" id="lastPriceFoil"><p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats">
						<i class="fa fa-calendar-o"></i>Last day 
                </div>
              </div>
            </div>
          </div>
          
            <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="card card-stats">
              <div class="card-body ">
                <div class="row">
                  <div class="col-5 col-md-4">
                    <div class="icon-big text-center icon-warning">
                      <i class="fa fa-share-alt text-warning"></i>
                    </div>
                  </div>
                  <div class="col-7 col-md-8">
                    <div class="numbers">
                      <p class="card-category">Share</p>
                    </div>
                    <span id="linkshare"></span>
                  </div>
                </div>
              </div>
              <div class="card-footer ">
                <hr>
              </div>
            </div>
          </div>
          
          
        </div>

		



       <div class="row">
          <div class="col-md-12">
            <div class="card card-chart">
              <div class="card-header">
                <h5 class="card-title">Prices Variations</h5>
                <p class="card-category">History prices</p>
              </div>
              <div class="card-body">
                <canvas id="speedChart" width="400" height="100"></canvas>
              </div>
              <div class="card-footer">
                <hr />
                <div class="card-stats">
                  <i class="fa fa-check"></i> <span id="provider"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer class="footer footer-black  footer-white ">
        <div class="container-fluid">
          <div class="row">
            <nav class="footer-nav">
            </nav>
          </div>
        </div>
      </footer>
    </div>
  </div>
 </body>

</html>
