<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta name="description" content="" />
	<meta name="author" content="MTGCompanion" />
	<title>MTGCompanion - Collections</title>
	<link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />

	<script src="//cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/jquery-autocomplete@latest/jquery.autocomplete.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/jquery-ui-dist@latest/jquery-ui.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="../dist/js/rest-server.js"></script>
	<script src="../js/scripts.js"></script>

	<script src="//cdn.jsdelivr.net/npm/datatables@latest/media/js/jquery.dataTables.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/datatables-bootstrap@latest/js/dataTables.bootstrap.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/datatables-responsive@latest/js/dataTables.responsive.min.js"></script>
	<script src="//cdn.datatables.net/buttons/2.0.0/js/dataTables.buttons.min.js"></script>

	<link href="//cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
	<link href="//cdn.datatables.net/1.11.0/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
	<link href="//cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href="//cdn.jsdelivr.net/npm/mana-font@latest/css/mana.css" rel="stylesheet" type="text/css" />
	<link href="//cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
	<link href="//cdn.datatables.net/buttons/2.0.0/css/buttons.dataTables.min.css" rel="stylesheet" type="text/css" />
	<link href="//cdn.jsdelivr.net/npm/keyrune@latest/css/keyrune.css" rel="stylesheet" type="text/css" />
	<link href="//cdn.jsdelivr.net/npm/jquery-ui-dist@latest/jquery-ui.min.css" rel="stylesheet">
	<link href="//cdn.jsdelivr.net/npm/datatables@latest/media/css/jquery.dataTables.min.css" rel="stylesheet"
		type="text/css">

	<link href="../css/styles.css" rel="stylesheet" />

	<script>
		$(document).ready(function () {

			$.ajax({
				url: restserver + "/collections/list"
			}).then(function (data) {
				$.each(data, function (key, value) {
					$("#items-menu").append("<li><a class='dropdown-item' href='?collection=" + value.name + "'><em class='fa	fa-book'></em> " + value.name + "</a></li>")
				});
				$("#items-menu").append("<li><div class='dropdown-divider'></div></li>");
				$("#items-menu").append("<li><a class='dropdown-item' href='list.html''><em class='fa fa-th-list'></em> View as list</a></li>");



			}); // end	

			$('#table').DataTable({
				"language": {
					"search": "Search",
					"processing": "<img src='../img/loading.gif' width='50' height='50'>"
				},
				"responsive": true,
				"processing": true,
				"pageLength": 50,
				buttons: [
					'copy', 'csv', 'excel', 'pdf', 'print'
				],
				"ajax": {"url": restserver + "/cards/" + $_GET("collection"), "dataSrc": ""},
				"columns": [
					{
						"data": "editions",
						"width": "2%",
						"defaultContent": "common",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								try {
									data = '<i class="ss ss-' + data[0].id.toLowerCase() + ' ss-' + row.rarity.toLowerCase() + ' ss-2x ss-uncommon"></i>';
								} catch (error) {
									data = '<i class="ss ss-' + data[0].id.toLowerCase() + ' ss-common ss-2x"></i>';
								}
							}
							return data;
						}
					},
					{
						"data": "name",
						"width": "15%",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								data = "<span scryfallid='" + row.scryfallId + "' multiverseid='" + row.editions[0].multiverseId + "' class='mtg-tooltip'>" + data + "</span>";

							}
							return data;
						}
					},
					{
						"data": "editions",
						"width": "15%",
						"defaultContent": "common",
						"render": function (data, type, row, meta) {
							return data[0].set;
						}
					},
					{
						"data": "id",
						"width": "5%",
						"defaultContent": "",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								data = row.editions[0].number + "/" + row.editions[0].cardCount;

							}
							return data;
						}
					},
					{
						"data": "types",
						"width": "10%",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								data = '<i class="ms ms-' + data[0].toLowerCase() + ' ms-2x"></i>' + data;
							}
							return data;
						}
					},
					{
						"data": "cost",
						"width": "10	%",
						"defaultContent": "",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								if (data != null) {
									var d = data.match(/[^{}]+(?=\})/g);
									if (d != null) {
										var ret = "";
										for (var i = 0; i < d.length; i++) {
											d[i] = formatMana(d[i]);
											ret += '<em class="ms ms-' + d[i].toLowerCase() + ' ms-cost ms-shadow"></em>';
										}
									}
								}
								return ret;
							}
						}
					},
					{
						"data": "frameEffects",
						"defaultContent": "",
						"width": "3%",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								if (data.indexOf("SHOWCASE") > -1)
									data = "<span class='fa fa-check'/>";
								else
									data = "<span class='fa fa-times'/>";
							}
							return data;
						}
					},
					{
						"data": "frameEffects",
						"defaultContent": "",
						"width": "3%",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								if (data.indexOf("EXTENDEDART") > -1)
									data = "<span class='fa fa-check'/>";
								else
									data = "<span class='fa fa-times'/>";
							}
							return data;
						}
					},
					{
						"data": "border",
						"defaultContent": "",
						"width": "3%",
						"render": function (data, type, row, meta) {
							
							if (type === 'display') {
								if(!data)
									{
									console.log(data + " " + row.name + " " + row.editions[0].id + "  not updated" );	
									return data;
									}	
								
								if (data.indexOf("BORDERLESS") > -1)
									data = "<span class='fa fa-check'/>";
								else
									data = "<span class='fa fa-times'/>";
							}
							return data;
						}
					},
					{
						"data": "reserved",
						"defaultContent": "",
						"width": "3%",
						"render": function (data, type, row, meta) {
							if (type === 'display') {
								if (data === true)
									data = "<span class='fa fa-check'/>";
								else
									data = "<span class='fa fa-times'/>";
							}
							return data;
						}
					}
					
					],
				"fnDrawCallback": function (oSettings, json) {
					mtgtooltip($(".mtg-tooltip"));
				}
			});
		});


	</script>


</head>


<body>
	<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
		<div class="container px-4 px-lg-0">
			<a class="navbar-brand" href="index.html"><img src="../img/logo.png" />MTG Companion</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
				data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
					<li class="nav-item"><a class="nav-link active" aria-current="page" href="/">Home</a></li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button"
							data-bs-toggle="dropdown" aria-expanded="false">Collections</a>
						<ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="items-menu">

						</ul>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- Header-->
	<header class="bg-dark py-3">

	</header>



	<!-- Section-->
	<section class="py-5">
		<div class="container px-4 px-lg-0 mt-5">

			<table id="table" class="display" style="width:100%">
				<thead>
					<tr>
						<th></th>
						<th>Card</th>
						<th>Edition</th>
						<th>Number</th>
						<th>Type</th>
						<th>Cost</th>
					    <th>Showcase</th>
	  					<th>Extended</th>
						<th>Borderless</th>
						<th>Reserved</th>
					</tr>
				</thead>
			</table>


		</div>
	</section>
	<!-- Footer-->
	<footer class="py-5 bg-dark">
		<div class="container">
			<p class="m-0 text-center text-white"><a href='https://www.mtgcompanion.org'>https://www.mtgcompanion.org</a></p>
		</div>
	</footer>

</body>

</html>