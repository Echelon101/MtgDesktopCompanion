<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>MTG Web Companion</title>
  
  <link rel="icon" type="image/png" href="../dist/img/logo-ct.png">
  <link href="https://cdn.jsdelivr.net/npm/keyrune@latest/css/keyrune.css" rel="stylesheet" type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/mana-font@latest/css/mana.css" rel="stylesheet" type="text/css" />

  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link id="pagestyle" href="../dist/css/material-dashboard.css?v=3.0.0" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/keyrune@latest/css/keyrune.css" rel="stylesheet" type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href="https://unpkg.com/@trevoreyre/autocomplete-js/dist/style.css" rel="stylesheet" />
 
  <script src="//unpkg.com/@trevoreyre/autocomplete-js"></script>    

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/1.5.5/perfect-scrollbar.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/smooth-scrollbar/8.7.4/smooth-scrollbar.min.js"></script>
  
  <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/plug-ins/1.10.19/api/sum().js"></script>
  <script src="../dist/js/rest-server.js"></script>
  <script src="../dist/js/js-var.js"></script>
  <script src="../dist/js/mtgcompanion-ui.js"></script>
  
  <script>
 		$(document).ready(function() {
			$("#sidenav-main" ).load("inc/menu.html" );
			$("#navbarBlur").load("inc/nav.html",function(){
				$("[name='categTitle']").html("Card");
				document.getElementById('iconNavbarSidenav').addEventListener("click", toggleSidenav);
				/*$("#menuDecks").addClass("bg-gradient-primary");
				$("#menuDecks").addClass("active");*/
			});
			$("#navfooter").load("inc/footer.html");
			$("#settingPanel").load("inc/settingPanel.html");
	
	
	
	
	  		$.ajax({
			        url: restserver+"/cards/scryfall/"+$_GET("scryfallid")
		    }).then(function(card) {
    					
	
						if(card.scryfallId)
							uri = "https://api.scryfall.com/cards/"+card.scryfallId+"?format=image";
						else if(card.editions[0].multiverseId)            
							uri = "https://api.scryfall.com/cards/multiverse/"+card.editions[0].multiverseId+"?format=image";
						
						$('#pic').attr("src", uri);
						$("#cardname").html(card.name);
						$("#artist").html(card.artist);
						$('#number').append(card.editions[0].number +"/" + card.editions[0].cardCountOfficial);
						$('#types').append(card.types);
						$("#oracleText").append(card.text.replace(/\n/g, "<br />"));
						
						
						if(card.power!=null)
  	    					$('#power').append(card.power+"/"+card.toughness);
  	    	
			  	    	if(card.loyalty!=null)
			  	    		$('#loyalty').append(card.loyalty);
  	    	
  	    				if(card.layout!=null)
  	    					$('#layout').append(card.layout);

						if(card.promoCard==true)
			  	    		$('#promoCard').append(" <i class='fa fa-check-circle'></i>");
			  	    	else
			  	    		$('#promoCard').append(" <i class='fa fa-times-circle'></i>");
			  	    	
			  	    	if(card.reserved==true)
			  	    		$('#reserved').append(" <i class='fa fa-check-circle'></i>");
			  	    	else
			  	    		$('#reserved').append(" <i class='fa fa-times-circle'></i>");
			  	    	
			  	    	if(card.reprintedCard==true)
			  	    		$('#reprintedCard').append(" <i class='fa fa-check-circle'></i>");
			  	    	else
			  	    		$('#reprintedCard').append(" <i class='fa fa-times-circle'></i>");
			  	    	
			  	    	if(card.arenaCard==true)
			  	    		$('#arenaCard').append(" <i class='fa fa-check-circle'></i>");
			  	    	else
			  	    		$('#arenaCard').append(" <i class='fa fa-times-circle'></i>");
			  	    	
			  	    	if(card.mtgoCard==true)
			  	    		$('#mtgoCard').append(" <i class='fa fa-check-circle'></i>");
			  	    	else
			  	    		$('#mtgoCard').append(" <i class='fa fa-times-circle'></i>");
			  	    	
			  	    	if(card.onlineOnly==true)
			  	    		$('#onlineOnly').append(" <i class='fa fa-check-circle'></i>");
			  	    	else
			  	    		$('#onlineOnly').append(" <i class='fa fa-times-circle'></i>");
			  	    	
				 		if(card.frameEffects.indexOf("SHOWCASE")>-1)
		                   		$('#showcase').append(" <i class='fa fa-check-circle'></i>");
						  else if(card.frameEffects.indexOf("EXTENDEDART")>-1)
		                  		$('#extendedArt').append(" <i class='fa fa-check-circle'></i>");
						  else if(card.border=="BORDERLESS")
								$('#Borderless').append(" <i class='fa fa-check-circle'></i>");	
						
						
			if(card.colors.length>1)
  	    	{
					$(".bg-gradient-primary").toggleClass("bg-gradient-warning");
  	    	}
  	    	else if(card.colors.length==0)
  	    	{
					$(".bg-gradient-primary").toggleClass("bg-gradient-brown");
			}
  	    	else
  	    	{
  	    		if(card.colors[0]=='WHITE')
					$(".bg-gradient-primary").toggleClass("bg-gradient-light");
  	  			if(card.colors[0]=='BLUE')
					$(".bg-gradient-primary").toggleClass("bg-gradient-info");
  				if(card.colors[0]=='BLACK')
					$(".bg-gradient-primary").toggleClass("bg-gradient-dark");
				if(card.colors[0]=='RED')
					$(".bg-gradient-primary").toggleClass("bg-gradient-danger");
				if(card.colors[0]=='GREEN')
					$(".bg-gradient-primary").toggleClass("bg-gradient-success");
  	    	}

						
						

						if(card.cost!=null)
				  	    	{
				  	    	   var d=card.cost.match(/[^{}]+(?=\})/g);
				  	      	   if(d!=null){
				  	      		   var ret="";
				  	      		   for (var i = 0; i < d.length; i++) {
				        			   d[i]=formatMana(d[i]);
				  	      			   $('#cost').append('<i class="ms ms-'+d[i].toLowerCase()+' ms-cost ms-shadow"></i>');
				  	      			}
				  	      	   }
				  	    	}
						
						$.get(restserver+"/dash/variations/card/"+card.id,function(dprice){
								printChartPrices("chartPrice",dprice);

								var vallast = dprice.normal[dprice.normal.length - 1].value;
								var vallastF = dprice.foil[dprice.foil.length - 1].value;
								
								var valpreLast = dprice.normal[dprice.normal.length - 7].value;
								var pc = new Number(( ( vallast - valpreLast ) / valpreLast ) * 100);
								
								$("#priceVariation").html(pc.toFixed(2) +"%");
								
								if(pc>0)
									$("#priceVariation").addClass("text-success");
								else
									$("#priceVariation").addClass("text-danger");
								
								
								$("#lastPrice").html(vallast.toFixed(2) + " /  " + vallastF.toFixed(2) + "(F) " + dprice.currency);
						});					
						
						 $.get({
			  	  	        url: restserver+"/collections/cards/"+card.id
					  	  	    }).then(function(data) {
					  	  	    	for (var i = 0; i < data.length; i++) {
					  	  	    		$('#collections').append(data[i].name);
					  	  	    	}
					  	  	    });
						
						
						 	$("#alertBtn").click( function() {
					  				$("#toastMessage").html(card.name + " has been added to Alerts");
									$("#toastTitle").html("Add Alert to Card");
									$("#infoToast").toast("show");
					 		});
					  		
						
							$("#stockBtn").click( function() {
					  				$("#toastMessage").html(card.name + " has been added to Stock");
									$("#toastTitle").html("Add card in Stock");
									$("#infoToast").toast("show");
					 		});
						
							$("#addCardBtn").click( function() {
					  				$("#toastMessage").html(card.name + " has been added to default Library");
									$("#toastTitle").html("Add card in Collection");
									$("#infoToast").toast("show");
					 		});
						
						
						
				});
			
			
		});
</script>
</head>

<body class="g-sidenav-show  bg-gray-200">
 	<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 menu-left fixed-start bg-gradient-dark" id="sidenav-main"></aside>
  	<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
	<nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" navbar-scroll="true"></nav>
  
    <div class="container-fluid py-4">

    <div class="row ">

    		<div class="col-lg-3 col-md-3">
				<div class="card">
					<div class="card-header p-0 position-relative mt-n4 mx-3">
						<div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
							<h6 class="text-white text-capitalize ps-3" id="cardname">Card Name</h6>
						</div>
					</div>
					<div class="card-body px-4 pb-2">
						<img class='img-fluid img-responsive' id='pic' data-holder-rendered="true" />
					</div>
					<div class="card-footer p-3">
						<i><span id="artist"></span></i>
					</div>
				</div>
				
				<br/><br/>
				<div class="card">
					<div class="card-header p-0 position-relative mt-n4 mx-3">
						<div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
							<h6 class="text-white text-capitalize ps-3" id="cardname">Collections</h6>
						</div>
					</div>
					<div class="card-body px-4 pb-2">
						 <ul class="list-group" id="collections"></ul>       
					</div>
					<div class="card-footer p-3">
						
					</div>
				</div>
				
				
			</div>
        
			<div class="col-lg-3 col-md-6">
				<div class="card">
					<div class="card-header p-0 position-relative mt-n4 mx-3">
						<div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
							<h6 class="text-white text-capitalize ps-3">Description</h6>
						</div>
					</div>
					<div class="card-body p-3">
						<table class="table table-borderless  table-hover specialCollapse">
							<tbody>
								<tr>
									<td>
										<p id="cost"><strong>Cost : </strong></p>
									</td>
									<td>
										<p id="types"><strong>Types :</strong></p>
									</td>
									<td>
										<p id="power"><strong>Power :</strong></p>
									</td>
								<tr>
								<tr>
									<td>
										<p id="number"><strong>Number :</strong></p>
									</td>
									<td>
										<p id="loyalty"><strong>Loyalty :</strong></p>
									</td>
									<td>
										<p id="layout"><strong>Layout :</strong></p>
									</td>
				
								</tr>
								<tr>
									<td>
										<p id="reserved"><strong>Reserved :</strong></p>
									</td>
									<td>
										<p id="promoCard"><strong>Promo :</strong></p>
									</td>
									<td>
										<p id="reprintedCard"><strong>Reprinted :</strong></p>
									</td>
								</tr>
								<tr>
									<td>
										<p id="arenaCard"><strong>MTGArena :</strong></p>
									</td>
									<td>
										<p id="mtgoCard"><strong>MTGO :</strong></p>
									</td>
									<td>
										<p id="onlineOnly"><strong>Online Only :</strong></p>
									</td>
								</tr>
								<tr>
									<td>
										<p id="showcase"><strong>Showcase :</strong></p>
									</td>
									<td>
										<p id="borderless"><strong>Borderless :</strong></p>
									</td>
									<td>
										<p id="extendedArt"><strong>Extended Art :</strong></p>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<br/></br/>
				
				<div class="card">
					<div class="card-header p-0 position-relative mt-n4 mx-3 ">
						<div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
							<h6 class="text-white text-capitalize ps-3">Oracle Text</h6>
						</div>
					</div>
					<div class="card-body p-3">
						<p id="oracleText"></p>
					</div>
				</div>
				
				
				<br/>
				<br/>
				<div class="card">
					<div class="card-header p-0 position-relative mt-n4 mx-3 ">
						<div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
							<h6 class="text-white text-capitalize ps-3">Actions</h6>
						</div>
					</div>
					<div class="card-body p-3" id="panelBtn">
							<button id="alertBtn" type="button" class="btn btn-circle btn-warning toast-btn" data-bs-placement="bottom" data-bs-toggle="tooltip"="tooltip" title="add alert" >
								<em class="fa fa-bell-o"></em>
							</button>
							<button id="stockBtn" type="button" class="btn btn-circle btn-primary toast-btn" data-bs-placement="bottom" data-bs-toggle="tooltip"="tooltip" title="add to stock">
								<em class="fa fa-file-text"></em>
							</button>
							<button id="addCardBtn" type="button" class="btn btn-circle btn-danger toast-btn" data-bs-placement="bottom" data-bs-toggle="tooltip"="tooltip" title="add to default library">
								<em class="fa fa-plus-circle"></em>
							</button>
					</div>
				</div>
				
				
				
				
</div>


			<div class="col-lg-6 col-md-6">
			
					<div class="card ">
					<div class="card-header p-0 position-relative mt-n4 mx-3 ">
						<div class=" bg-gradient-primary  shadow-primary border-radius-lg pt-4 pb-3">
							<h6 class="text-white text-capitalize ps-3" id="lastPrice"></h6>
						</div>
					</div>
					<div class="card-body p-3">
						 
					</div>
					<div class="card-footer p-3">
		              <p class="mb-0" id="priceMouvement"><span class="text-sm font-weight-bolder" id="priceVariation"></span> since last week</p>
		            </div>
					
				</div>
			
			
			<br/><br/>
				<div class="card ">
					<div class="card-header p-0 position-relative mt-n4 mx-3 ">
						<div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
							<h6 class="text-white text-capitalize ps-3">History</h6>
						</div>
					</div>
					<div class="card-body p-3">
						<canvas id="chartPrice" width="400" height="200"></canvas>
					</div>
				</div>
				
			
				
				
				
				
			</div>
			
			
			
</div>



      <footer class="footer py-4" id="navfooter"></footer>
    </div>
	
	
  </main>
  <div class="fixed-plugin">
    <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
      <i class="material-icons py-2">settings</i>
    </a>
    <div class="card shadow-lg" id="settingPanel">
      
    </div>
  </div>
 
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  
  
   <script src="../dist/js/material-dashboard.js?v=3.0.0"></script>

  <div class="position-fixed bottom-1 end-1 z-index-3">
       
		<div class="toast fade hide p-2 mt-2 bg-gradient-info" role="alert" aria-live="assertive" id="infoToast" aria-atomic="true">
          <div class="toast-header bg-transparent border-0">
            <i class="material-icons text-white me-2">notifications</i>
            <span class="me-auto text-white font-weight-bold" id="toastTitle">Title</span>
            <small class="text-white"></small>
            <i class="fa fa-times text-md text-white cursor-pointer" data-bs-dismiss="toast" aria-label="Close"></i>
          </div>
          <hr class="horizontal light m-0">
          <div class="toast-body text-white" id="toastMessage">
           				 Hello, world! This is a notification message.
          </div>
        </div>






  </div>
 
</body>

</html>